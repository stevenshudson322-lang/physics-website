<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <title>Cannon Launching Simulator</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        main {
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        #gameContainer {
            position: relative;
            width: 1200px;
            height: 800px;
            margin: 20px auto;
            border: 3px solid #333;
            background-color: white;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .game-info {
            max-width: 1200px;
            margin: 20px auto;
            padding: 15px;
            background-color: #e8f4f8;
            border-left: 5px solid #0066cc;
            border-radius: 5px;
        }

        .game-info h3 {
            margin-top: 0;
            color: #0066cc;
        }

        .game-info ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .game-info li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Physics Simulations</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="topics.html">Topics</a>
            <a href="games.html">Games</a>
        </nav>
    </header>

    <main>
        <h1>ðŸŽ¯ Cannon Launching Simulator</h1>
        
        <div id="gameContainer">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="game-info">
            <h3>How to Play:</h3>
            <ul>
                <li><strong>Press SPACE</strong> to start a new round</li>
                <li><strong>Enter an angle</strong> (0-90 degrees) for the cannon barrel</li>
                <li><strong>Enter a velocity</strong> (1-50 m/s) for the launch speed</li>
                <li>Watch the <span style="color: green;">green trajectory line</span> showing where the ball will go</li>
                <li>Try to hit the red target!</li>
                <li>Use the <strong>distance scale (bottom)</strong> and <strong>height scale (left)</strong> to calculate the correct angle and velocity</li>
            </ul>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        canvas.width = 1200;
        canvas.height = 800;

        // Game constants
        const CANNON_X = 50;
        const CANNON_Y = canvas.height - 50;
        const GRAVITY = 9.81;
        const SCALE = 10;
        const TIME_STEP = 0.016; // 60 FPS

        // Colors
        const WHITE = '#ffffff';
        const BLACK = '#000000';
        const RED = '#ff0000';
        const BLUE = '#0000ff';
        const GRAY = '#808080';
        const GREEN = '#00ff00';

        // Game states
        const GameState = {
            WAITING: 1,
            AIMING: 2,
            FIRING: 3,
            HIT: 4
        };

        // Game variables
        let cannonAngle = 45;
        let cannonVelocity = 10;
        let targetX = 0;
        let targetY = 0;
        let gameState = GameState.WAITING;
        let trajectory = [];
        let cannonballPos = null;
        let cannonballVel = null;
        let inputText = '';
        let inputMode = null; // null, 'angle', or 'velocity'

        function drawCannon() {
            const barrelLength = 25;
            const endX = CANNON_X + barrelLength * Math.cos((cannonAngle * Math.PI) / 180);
            const endY = CANNON_Y - barrelLength * Math.sin((cannonAngle * Math.PI) / 180);

            // Draw cannon base
            ctx.fillStyle = BLACK;
            ctx.beginPath();
            ctx.arc(CANNON_X, CANNON_Y, 10, 0, Math.PI * 2);
            ctx.fill();

            // Draw barrel
            ctx.strokeStyle = BLACK;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(CANNON_X, CANNON_Y);
            ctx.lineTo(endX, endY);
            ctx.stroke();
        }

        function drawTarget() {
            // Outer circle
            ctx.fillStyle = RED;
            ctx.beginPath();
            ctx.arc(targetX, targetY, 12, 0, Math.PI * 2);
            ctx.fill();

            // Middle circle
            ctx.fillStyle = WHITE;
            ctx.beginPath();
            ctx.arc(targetX, targetY, 8, 0, Math.PI * 2);
            ctx.fill();

            // Center dot
            ctx.fillStyle = RED;
            ctx.beginPath();
            ctx.arc(targetX, targetY, 4, 0, Math.PI * 2);
            ctx.fill();
        }

        function calculateTrajectory() {
            trajectory = [];
            const angleRad = (cannonAngle * Math.PI) / 180;
            let vx = cannonVelocity * Math.cos(angleRad);
            let vy = cannonVelocity * Math.sin(angleRad);

            let posX = CANNON_X;
            let posY = CANNON_Y;
            let velX = vx;
            let velY = -vy;

            for (let i = 0; i < 300; i++) {
                posX += velX * TIME_STEP * SCALE;
                posY += velY * TIME_STEP * SCALE;
                velY += GRAVITY * TIME_STEP;

                if (posY > canvas.height || posX > canvas.width) {
                    break;
                }
                trajectory.push({ x: Math.round(posX), y: Math.round(posY) });
            }
        }

        function drawTrajectory() {
            ctx.fillStyle = GREEN;
            for (let i = 0; i < trajectory.length; i += 2) {
                const pos = trajectory[i];
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateCannonball() {
            if (!cannonballPos) return;

            cannonballPos.x += cannonballVel.x * TIME_STEP * SCALE;
            cannonballPos.y += cannonballVel.y * TIME_STEP * SCALE;
            cannonballVel.y += GRAVITY * TIME_STEP;

            if (cannonballPos.y > canvas.height || cannonballPos.x > canvas.width) {
                gameState = GameState.WAITING;
                cannonballPos = null;
                return;
            }

            const dx = cannonballPos.x - targetX;
            const dy = cannonballPos.y - targetY;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 20) {
                gameState = GameState.HIT;
                cannonballPos = null;
            }
        }

        function drawCannonball() {
            if (!cannonballPos) return;

            ctx.fillStyle = BLACK;
            ctx.beginPath();
            ctx.arc(cannonballPos.x, cannonballPos.y, 5, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = GRAY;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(cannonballPos.x, cannonballPos.y, 5, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawMeasurementScales() {
            const scaleFont = '28px Arial';
            const labelFont = '32px Arial';

            // X-axis
            const meterPerPixelX = 100 / (canvas.width - CANNON_X);
            ctx.strokeStyle = BLACK;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(CANNON_X, canvas.height - 30);
            ctx.lineTo(canvas.width, canvas.height - 30);
            ctx.stroke();

            ctx.fillStyle = BLACK;
            ctx.font = scaleFont;
            ctx.textAlign = 'center';
            for (let i = CANNON_X; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, canvas.height - 30);
                ctx.lineTo(i, canvas.height - 15);
                ctx.stroke();

                const meters = Math.round((i - CANNON_X) * meterPerPixelX);
                ctx.fillText(`${meters}m`, i, canvas.height - 5);
            }

            // Y-axis
            const meterPerPixelY = 600 / (canvas.height - 100);
            ctx.beginPath();
            ctx.moveTo(CANNON_X - 30, 100);
            ctx.lineTo(CANNON_X - 30, canvas.height - 50);
            ctx.stroke();

            ctx.textAlign = 'right';
            for (let i = 100; i < canvas.height - 50; i += 50) {
                ctx.beginPath();
                ctx.moveTo(CANNON_X - 30, i);
                ctx.lineTo(CANNON_X - 10, i);
                ctx.stroke();

                const meters = Math.round((canvas.height - 50 - i) * meterPerPixelY);
                ctx.fillText(`${meters}m`, CANNON_X - 35, i + 10);
            }

            // Axis labels
            ctx.font = labelFont;
            ctx.fillStyle = BLACK;
            ctx.textAlign = 'center';
            ctx.fillText('Distance (m)', canvas.width - 100, canvas.height - 50);

            ctx.textAlign = 'right';
            ctx.save();
            ctx.translate(20, 100);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Height (m)', 0, 0);
            ctx.restore();
        }

        function drawUI() {
            ctx.fillStyle = BLACK;
            ctx.font = '36px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Angle: ${cannonAngle.toFixed(1)}Â° | Velocity: ${cannonVelocity.toFixed(1)} m/s`, 10, 40);

            if (gameState === GameState.WAITING) {
                ctx.fillStyle = BLUE;
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Press SPACE to START', canvas.width / 2, 300);
            } else if (gameState === GameState.AIMING) {
                if (inputMode === 'angle') {
                    ctx.fillStyle = BLACK;
                    ctx.font = '36px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('Enter angle (0-90):', 100, 100);
                    ctx.fillStyle = BLUE;
                    ctx.font = 'bold 48px Arial';
                    ctx.fillText(inputText, 100, 160);
                } else if (inputMode === 'velocity') {
                    ctx.fillStyle = BLACK;
                    ctx.font = '36px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('Enter velocity (1-50):', 100, 100);
                    ctx.fillStyle = BLUE;
                    ctx.font = 'bold 48px Arial';
                    ctx.fillText(inputText, 100, 160);
                }
            } else if (gameState === GameState.FIRING) {
                ctx.fillStyle = RED;
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('FIRING!', 100, 100);
            } else if (gameState === GameState.HIT) {
                ctx.fillStyle = GREEN;
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('CONGRATS! You hit the target!', canvas.width / 2, 300);
                ctx.fillStyle = BLUE;
                ctx.font = '36px Arial';
                ctx.fillText('Press SPACE for next round', canvas.width / 2, 360);
            }
        }

        function gameLoop() {
            // Clear canvas
            ctx.fillStyle = WHITE;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw target if aiming or firing
            if (gameState === GameState.AIMING || gameState === GameState.FIRING || gameState === GameState.HIT) {
                drawTarget();
            }

            // Draw trajectory only during firing
            if (gameState === GameState.FIRING) {
                drawTrajectory();
            }

            // Update and draw cannonball
            updateCannonball();
            drawCannonball();

            // Draw cannon and scales
            drawCannon();
            drawMeasurementScales();
            drawUI();

            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        document.addEventListener('keydown', (event) => {
            if (inputMode === 'angle') {
                if (event.key === 'Enter' && inputText) {
                    const angle = parseFloat(inputText);
                    if (!isNaN(angle)) {
                        cannonAngle = Math.max(0, Math.min(90, angle));
                        inputText = '';
                        inputMode = 'velocity';
                    } else {
                        inputText = '';
                    }
                } else if (event.key === 'Backspace') {
                    inputText = inputText.slice(0, -1);
                } else if (/[\d.]/.test(event.key)) {
                    inputText += event.key;
                }
            } else if (inputMode === 'velocity') {
                if (event.key === 'Enter' && inputText) {
                    const velocity = parseFloat(inputText);
                    if (!isNaN(velocity)) {
                        cannonVelocity = Math.max(1, Math.min(50, velocity));
                        inputText = '';
                        inputMode = null;

                        // Launch cannon
                        const angleRad = (cannonAngle * Math.PI) / 180;
                        const barrelLength = 25;
                        const barrelEndX = CANNON_X + barrelLength * Math.cos(angleRad);
                        const barrelEndY = CANNON_Y - barrelLength * Math.sin(angleRad);

                        cannonballPos = { x: barrelEndX, y: barrelEndY };
                        cannonballVel = {
                            x: cannonVelocity * Math.cos(angleRad),
                            y: -cannonVelocity * Math.sin(angleRad)
                        };

                        gameState = GameState.FIRING;
                        calculateTrajectory();
                    } else {
                        inputText = '';
                    }
                } else if (event.key === 'Backspace') {
                    inputText = inputText.slice(0, -1);
                } else if (/[\d.]/.test(event.key)) {
                    inputText += event.key;
                }
            } else if (event.key === ' ') {
                event.preventDefault();
                if (gameState === GameState.WAITING) {
                    targetX = Math.random() * (canvas.width - 400) + 400;
                    targetY = Math.random() * (canvas.height - 200) + 100;
                    gameState = GameState.AIMING;
                    inputMode = 'angle';
                    inputText = '';
                } else if (gameState === GameState.HIT) {
                    targetX = Math.random() * (canvas.width - 400) + 400;
                    targetY = Math.random() * (canvas.height - 200) + 100;
                    gameState = GameState.AIMING;
                    inputMode = 'angle';
                    inputText = '';
                }
            }
        });

        // Start game loop
        gameLoop();
    </script>
</body>
</html>
